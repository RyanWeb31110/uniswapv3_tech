# UniswapV3 æŠ€æœ¯å­¦ä¹ ç³»åˆ—ï¼ˆå››ï¼‰ï¼šå¼€å‘ç¯å¢ƒæ­å»º

## ç³»åˆ—ä»‹ç»

æœ¬æ–‡æ˜¯ UniswapV3 æŠ€æœ¯å­¦ä¹ ç³»åˆ—çš„ç¬¬å››ç¯‡ã€‚åœ¨å‰ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥å­¦ä¹ äº† AMM çš„ç†è®ºåŸºç¡€ã€æ’å®šä¹˜ç§¯å…¬å¼çš„æ•°å­¦åŸç†ï¼Œä»¥åŠ Uniswap V3 çš„é©å‘½æ€§åˆ›æ–°ã€‚ä»æœ¬æ–‡å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥**å®æˆ˜å¼€å‘é˜¶æ®µ**ï¼

åœ¨æ­£å¼ç¼–å†™æ™ºèƒ½åˆçº¦ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å¼€å‘çš„æ ¸å¿ƒå·¥å…·é“¾ï¼Œç‰¹åˆ«æ˜¯ **Foundry æ¡†æ¶**â€”â€”ç›®å‰æœ€ç°ä»£åŒ–ã€æœ€é«˜æ•ˆçš„ Solidity å¼€å‘å·¥å…·ã€‚

> **åŸæ–‡é“¾æ¥ï¼š** [Development Environment - Uniswap V3 Development Book](https://uniswapv3book.com/milestone_0/dev-environment.html)

---

## ä¸€ã€é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### 1.1 åŒå±‚åº”ç”¨æ¶æ„

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå®Œæ•´çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œå®ƒç”±ä¸¤ä¸ªç‹¬ç«‹ä½†ç›¸äº’åä½œçš„åº”ç”¨ç»„æˆï¼š

**é“¾ä¸Šåº”ç”¨ï¼ˆOn-chainï¼‰**

- **æœ¬è´¨**ï¼šéƒ¨ç½²åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„æ™ºèƒ½åˆçº¦é›†åˆ
- **è¯­è¨€**ï¼šSolidity
- **ç‰¹ç‚¹**ï¼šä¸å¯å˜ã€å»ä¸­å¿ƒåŒ–ã€é€æ˜å¯å®¡è®¡
- **æ ¸å¿ƒå†…å®¹**ï¼š
  - UniswapV3Poolï¼šæ ¸å¿ƒæ± å­åˆçº¦
  - UniswapV3Factoryï¼šå·¥å‚åˆçº¦
  - å„ç§æ•°å­¦åº“å’Œè¾…åŠ©åˆçº¦

**é“¾ä¸‹åº”ç”¨ï¼ˆOff-chainï¼‰**
- **æœ¬è´¨**ï¼šè¿è¡Œåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„å‰ç«¯ç•Œé¢
- **è¯­è¨€**ï¼šJavaScript/TypeScript + React
- **ç‰¹ç‚¹**ï¼šå¯éšæ—¶æ›´æ–°ã€ç”¨æˆ·å‹å¥½
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - å¯è§†åŒ–äº¤æ˜“ç•Œé¢
  - é’±åŒ…è¿æ¥
  - äº¤æ˜“æ•°æ®å±•ç¤º

### 1.2 å‰ç«¯åº”ç”¨çš„å®šä½

> ğŸ“Œ **é‡è¦è¯´æ˜**  
> è™½ç„¶å‰ç«¯åº”ç”¨å¼€å‘æ˜¯æœ¬ç³»åˆ—çš„ä¸€éƒ¨åˆ†ï¼Œä½†**ä¸æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒå…³æ³¨ç‚¹**ã€‚æˆ‘ä»¬æ„å»ºå‰ç«¯åº”ç”¨çš„ä¸»è¦ç›®çš„æ˜¯ï¼š
> - æ¼”ç¤ºå¦‚ä½•ä¸æ™ºèƒ½åˆçº¦äº¤äº’
> - æä¾›ç›´è§‚çš„æµ‹è¯•ç•Œé¢
> - ç†è§£ DApp çš„å®Œæ•´å·¥ä½œæµç¨‹
>
> å‰ç«¯ä»£ç æ˜¯**å¯é€‰çš„**ï¼Œä½†æˆ‘ä¼šæä¾›å®Œæ•´çš„å®ç°ä»£ç ä¾›å‚è€ƒã€‚

### 1.3 æŠ€æœ¯æ ˆå…¨æ™¯

![å¼€å‘ç¯å¢ƒæ¶æ„](../resource/dev_environment_architecture.svg)

---

## äºŒã€ä»¥å¤ªåŠåŸºç¡€çŸ¥è¯†

### 2.1 ä»¥å¤ªåŠä¸æ˜¯äº‘æœåŠ¡å™¨

å¾ˆå¤šå¼€å‘è€…åˆæ¬¡æ¥è§¦ä»¥å¤ªåŠæ—¶ï¼Œä¼šå°†å®ƒç±»æ¯”ä¸º AWS æˆ–é˜¿é‡Œäº‘ã€‚ä½†ä»¥å¤ªåŠä¸ä¼ ç»Ÿäº‘æœåŠ¡æœ‰ç€æœ¬è´¨åŒºåˆ«ï¼š

| å¯¹æ¯”ç»´åº¦ | ä¼ ç»Ÿäº‘æœåŠ¡ï¼ˆAWS/é˜¿é‡Œäº‘ï¼‰ | ä»¥å¤ªåŠåŒºå—é“¾ |
|---------|------------------------|-------------|
| **æ‰˜ç®¡è´¹ç”¨** | æŒ‰æ—¶é—´/æµé‡ä»˜è´¹ | ä¸æ”¶å–æ‰˜ç®¡è´¹ |
| **éƒ¨ç½²æˆæœ¬** | å…è´¹æˆ–æä½ | éœ€æ”¯ä»˜ Gas è´¹ç”¨ |
| **ä»£ç æ›´æ–°** | éšæ—¶æ›´æ–° | éƒ¨ç½²åä¸å¯ä¿®æ”¹ï¼ˆä¸å¯å˜æ€§ï¼‰ |
| **ä½¿ç”¨è®¡è´¹** | å¼€å‘è€…æ‰¿æ‹… | ç”¨æˆ·ä¸ºæ¯æ¬¡äº¤æ˜“ä»˜è´¹ |
| **æ•°æ®å­˜å‚¨** | ä¸­å¿ƒåŒ–æ•°æ®åº“ | åˆ†å¸ƒå¼è´¦æœ¬ |
| **è®¿é—®æ§åˆ¶** | éœ€è¦æˆæƒ | æ— éœ€è®¸å¯ï¼ˆPermissionlessï¼‰ |

### 2.2 ä»¥å¤ªåŠçš„æ ¸å¿ƒç»„æˆ

**æ•°æ®åº“å±‚ï¼šè´¦æˆ·çŠ¶æ€**

ä»¥å¤ªåŠçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼æ•°æ®åº“**ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ•°æ®æ˜¯**è´¦æˆ·çŠ¶æ€ï¼ˆAccount Stateï¼‰**ã€‚æ¯ä¸ªä»¥å¤ªåŠåœ°å€éƒ½æ˜¯ä¸€ä¸ªè´¦æˆ·ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

```solidity
// è´¦æˆ·çš„æ•°æ®ç»“æ„ï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰
struct Account {
    uint256 balance;      // ä½™é¢ï¼šè´¦æˆ·çš„ ETH ä½™é¢
    bytes code;           // ä»£ç ï¼šæ™ºèƒ½åˆçº¦çš„å­—èŠ‚ç 
    mapping storage;      // å­˜å‚¨ï¼šåˆçº¦çš„çŠ¶æ€å˜é‡
    uint256 nonce;        // Nonceï¼šé˜²æ­¢é‡æ”¾æ”»å‡»çš„è®¡æ•°å™¨
}
```

**1. Balanceï¼ˆä½™é¢ï¼‰**

- è´¦æˆ·æŒæœ‰çš„ ETH æ•°é‡
- ä»¥ Wei ä¸ºå•ä½ï¼ˆ1 ETH = 10^18 Weiï¼‰

**2. Codeï¼ˆä»£ç ï¼‰**
- å¦‚æœæ˜¯åˆçº¦è´¦æˆ·ï¼Œå­˜å‚¨åˆçº¦çš„å­—èŠ‚ç 
- å¤–éƒ¨è´¦æˆ·ï¼ˆEOAï¼‰æ­¤å­—æ®µä¸ºç©º

**3. Storageï¼ˆå­˜å‚¨ï¼‰**
- åˆçº¦çš„çŠ¶æ€å˜é‡å­˜å‚¨ç©ºé—´
- é”®å€¼å¯¹å½¢å¼ï¼ŒæŒä¹…åŒ–å­˜å‚¨

**4. Nonceï¼ˆéšæœºæ•°ï¼‰**
- å¤–éƒ¨è´¦æˆ·ï¼šå·²å‘é€çš„äº¤æ˜“æ•°é‡
- åˆçº¦è´¦æˆ·ï¼šåˆ›å»ºçš„åˆçº¦æ•°é‡

**å®‰å…¨ä¿éšœï¼š**

ä»¥å¤ªåŠçš„ä¸»è¦èŒè´£æ˜¯ä»¥**å®‰å…¨çš„æ–¹å¼**æ„å»ºå’Œç»´æŠ¤è¿™äº›æ•°æ®ï¼Œç¡®ä¿ï¼š
- ä¸å…è®¸æœªç»æˆæƒçš„è®¿é—®
- ä»»ä½•ä¿®æ”¹éƒ½ç»è¿‡éªŒè¯å’Œå…±è¯†
- æ•°æ®ä¸å¯ç¯¡æ”¹å’Œä¼ªé€ 

### 2.3 å»ä¸­å¿ƒåŒ–ç½‘ç»œ

ä»¥å¤ªåŠä¸ä»…æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œæ›´æ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–çš„è®¡ç®—æœºç½‘ç»œ**ï¼š

**ç½‘ç»œç‰¹ç‚¹ï¼š**
- ç”±å…¨çƒæ•°åƒä¸ªç‹¬ç«‹èŠ‚ç‚¹ç»„æˆ
- æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹ç»´æŠ¤å®Œæ•´çš„çŠ¶æ€å‰¯æœ¬
- é€šè¿‡å…±è¯†æœºåˆ¶è¾¾æˆä¸€è‡´

**å»ä¸­å¿ƒåŒ–çš„æ ¸å¿ƒç›®æ ‡ï¼š**

> **æ²¡æœ‰ä»»ä½•å•ä¸€æƒå¨å¯ä»¥å•æ–¹é¢ä¿®æ”¹æ•°æ®åº“ä¸­çš„ä»»ä½•å†…å®¹**

è¿™æ˜¯é€šè¿‡**å…±è¯†æœºåˆ¶ï¼ˆConsensusï¼‰** å®ç°çš„ï¼š
- æ‰€æœ‰èŠ‚ç‚¹éµå¾ªç›¸åŒçš„è§„åˆ™é›†
- ä»»ä½•è¯•å›¾è¿åè§„åˆ™çš„èŠ‚ç‚¹ä¼šè¢«ç½‘ç»œæ’æ–¥
- ä¿®æ”¹éœ€è¦ç½‘ç»œçš„é›†ä½“åŒæ„

> ğŸ’¡ **æœ‰è¶£çš„äº‹å®**  
> åŒºå—é“¾å¯ä»¥ä½¿ç”¨ MySQL ä½œä¸ºåº•å±‚æ•°æ®åº“ï¼ç†è®ºä¸Šæ²¡æœ‰ä»»ä½•æŠ€æœ¯éšœç¢ï¼Œåªæ˜¯æ€§èƒ½é—®é¢˜ã€‚å®é™…ä¸Šï¼Œä»¥å¤ªåŠä½¿ç”¨çš„æ˜¯ **LevelDB**â€”â€”ä¸€ä¸ªç”± Google å¼€å‘çš„é«˜æ€§èƒ½é”®å€¼æ•°æ®åº“ã€‚

### 2.4 ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰

**EVM çš„æœ¬è´¨ï¼š**

æ¯ä¸ªä»¥å¤ªåŠèŠ‚ç‚¹éƒ½è¿è¡Œ **EVMï¼ˆEthereum Virtual Machineï¼Œä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰**ï¼š
- è™šæ‹Ÿæœºæ˜¯"è¿è¡Œå…¶ä»–ç¨‹åºçš„ç¨‹åº"
- EVM æ˜¯ä¸“é—¨æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„è™šæ‹Ÿæœº
- æ‰€æœ‰èŠ‚ç‚¹è¿è¡Œç›¸åŒçš„ EVMï¼Œç¡®ä¿ç»“æœä¸€è‡´

**äº¤æ˜“ä¸æ™ºèƒ½åˆçº¦ï¼š**

ç”¨æˆ·é€šè¿‡**äº¤æ˜“ï¼ˆTransactionï¼‰** ä¸åˆçº¦äº¤äº’ï¼š

```javascript
// äº¤æ˜“çš„ç»„æˆéƒ¨åˆ†
{
  from: "0xå‘é€è€…åœ°å€",
  to: "0xåˆçº¦åœ°å€",
  value: "0", // å‘é€çš„ ETH æ•°é‡
  data: "0xå‡½æ•°é€‰æ‹©å™¨+å‚æ•°ç¼–ç ", // è°ƒç”¨æ•°æ®
  gasLimit: 100000,
  gasPrice: "20000000000"
}
```

**äº¤æ˜“æ•°æ®åŒ…å«ï¼š**
1. **å‡½æ•°é€‰æ‹©å™¨**ï¼šè¦è°ƒç”¨çš„åˆçº¦å‡½æ•°ï¼ˆç¼–ç åçš„å‡½æ•°åï¼‰
2. **å‚æ•°ç¼–ç **ï¼šå‡½æ•°çš„è¾“å…¥å‚æ•°ï¼ˆABI ç¼–ç ï¼‰

**äº¤æ˜“æµç¨‹ï¼š**
1. äº¤æ˜“è¢«æ‰“åŒ…åˆ°åŒºå—ä¸­
2. çŸ¿å·¥ï¼ˆæˆ–éªŒè¯è€…ï¼‰æŒ–çŸ¿/éªŒè¯åŒºå—
3. ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯äº¤æ˜“å’ŒåŒºå—
4. äº¤æ˜“è¢«æ‰§è¡Œï¼ŒçŠ¶æ€è¢«æ›´æ–°

### 2.5 æ™ºèƒ½åˆçº¦ vs JSON API

ç†è§£æ™ºèƒ½åˆçº¦çš„æœ€ä½³ç±»æ¯”æ˜¯ **JSON API**ï¼š

| JSON API | æ™ºèƒ½åˆçº¦ |
|----------|----------|
| HTTP ç«¯ç‚¹ | åˆçº¦åœ°å€ |
| GET/POST è¯·æ±‚ | äº¤æ˜“ |
| è°ƒç”¨å‡½æ•° | è°ƒç”¨åˆçº¦å‡½æ•° |
| ä¼ é€’å‚æ•° | æä¾›å‡½æ•°å‚æ•° |
| åç«¯é€»è¾‘ | åˆçº¦ä»£ç  |
| ä¿®æ”¹æ•°æ®åº“ | ä¿®æ”¹åˆçº¦å­˜å‚¨ |

**å…³é”®åŒºåˆ«ï¼š**

| ç‰¹æ€§ | JSON API | æ™ºèƒ½åˆçº¦ |
|-----|---------|----------|
| **çŠ¶æ€ä¿®æ”¹** | ç›´æ¥è°ƒç”¨ | éœ€è¦å‘é€äº¤æ˜“ |
| **è´¹ç”¨** | é€šå¸¸å…è´¹æˆ–å›ºå®šè´¹ç”¨ | æ¯æ¬¡äº¤æ˜“ä»˜ Gas è´¹ |
| **å“åº”é€Ÿåº¦** | æ¯«ç§’çº§ | ç§’åˆ°åˆ†é’Ÿçº§ |
| **æ•°æ®è¯»å–** | HTTP GET | å…è´¹çš„åˆçº¦è°ƒç”¨ |
| **ä¿®æ”¹æƒé™** | å¼€å‘è€…æ§åˆ¶ | ä»£ç é€»è¾‘æ§åˆ¶ |

### 2.6 JSON-RPC API

ä»¥å¤ªåŠèŠ‚ç‚¹å¯¹å¤–æš´éœ² **JSON-RPC API**ï¼Œå…è®¸æˆ‘ä»¬ï¼š

**æŸ¥è¯¢æ“ä½œï¼ˆå…è´¹ï¼‰ï¼š**

- `eth_getBalance`ï¼šè·å–è´¦æˆ·ä½™é¢
- `eth_getBlockByNumber`ï¼šè·å–åŒºå—ä¿¡æ¯
- `eth_call`ï¼šæ¨¡æ‹Ÿåˆçº¦è°ƒç”¨ï¼ˆä¸å‘é€äº¤æ˜“ï¼‰
- `eth_estimateGas`ï¼šä¼°ç®—äº¤æ˜“çš„ Gas æ¶ˆè€—

**äº¤æ˜“æ“ä½œï¼ˆéœ€è¦ä»˜è´¹ï¼‰ï¼š**
- `eth_sendTransaction`ï¼šå‘é€äº¤æ˜“
- `eth_sendRawTransaction`ï¼šå‘é€å·²ç­¾åçš„åŸå§‹äº¤æ˜“

**å®Œæ•´çš„ API åˆ—è¡¨ï¼š** [Ethereum JSON-RPC API](https://ethereum.org/en/developers/docs/apis/json-rpc/)

---

## ä¸‰ã€æ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·

### 3.1 ä¸»æµå¼€å‘æ¡†æ¶å¯¹æ¯”

ç›®å‰ä»¥å¤ªåŠç”Ÿæ€ä¸­æœ‰ä¸‰å¤§ä¸»æµå¼€å‘æ¡†æ¶ï¼š

**1. Truffleï¼ˆè€ç‰Œæ¡†æ¶ï¼‰**
- å†å²æœ€æ‚ ä¹…ï¼ˆ2015å¹´å‘å¸ƒï¼‰
- ä½¿ç”¨ JavaScript ç¼–å†™æµ‹è¯•
- ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™
- âŒ ä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨

**2. Hardhatï¼ˆä¸»æµé€‰æ‹©ï¼‰**
- Truffle çš„ç°ä»£åŒ–æ”¹è¿›ç‰ˆ
- ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›
- ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€
- âš ï¸ æµ‹è¯•éœ€è¦åœ¨ JavaScript å’Œ Solidity ä¹‹é—´åˆ‡æ¢

**3. Foundryï¼ˆæ–°é”æ¡†æ¶ï¼‰** â­ **æœ¬é¡¹ç›®é€‰æ‹©**

- æ–°ä¸€ä»£å¼€å‘å·¥å…·ï¼ˆ2021å¹´å‘å¸ƒï¼‰
- ä½¿ç”¨ Solidity ç¼–å†™æµ‹è¯•
- æå¿«çš„ç¼–è¯‘å’Œæµ‹è¯•é€Ÿåº¦
- âœ… å¼ºçƒˆæ¨èï¼Œæ­£åœ¨æˆä¸ºæ–°æ ‡å‡†

### 3.2 ä¸ºä»€ä¹ˆé€‰æ‹© Foundryï¼Ÿ

è™½ç„¶ Hardhat ä»ç„¶æ˜¯æœ€æµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œä½†è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®æ­£åœ¨è¿ç§»åˆ° Foundryã€‚åŸå› å¦‚ä¸‹ï¼š

**ä¼˜åŠ¿ 1ï¼šSolidity åŸç”Ÿæµ‹è¯•**

```solidity
// Foundry æµ‹è¯•ï¼ˆSolidityï¼‰
function testMint() public {
    uint256 amount = 1000;
    pool.mint(address(this), amount);
    assertEq(pool.balanceOf(address(this)), amount);
}
```

vs

```javascript
// Hardhat æµ‹è¯•ï¼ˆJavaScriptï¼‰
it("should mint tokens", async () => {
    const amount = ethers.BigNumber.from("1000");
    await pool.mint(await signer.getAddress(), amount);
    expect(await pool.balanceOf(await signer.getAddress()))
        .to.equal(amount);
});
```

**Foundry çš„ä¼˜åŠ¿ï¼š**

- âœ… æ— éœ€åœ¨ JS å’Œ Solidity ä¹‹é—´åˆ‡æ¢
- âœ… ä¸éœ€è¦ç‰¹æ®Šçš„ `BigNumber` ç±»å‹
- âœ… åŸç”Ÿæ”¯æŒæ‰€æœ‰ Solidity ç‰¹æ€§
- âœ… ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥é”™è¯¯

**ä¼˜åŠ¿ 2ï¼šæé€Ÿæµ‹è¯•æ‰§è¡Œ**

| æ¡†æ¶ | æµ‹è¯•æ–¹å¼ | é€Ÿåº¦ |
|------|---------|------|
| Hardhat/Truffle | å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ â†’ å‘é€äº¤æ˜“ â†’ æŒ–çŸ¿ | æ…¢ ğŸ¢ |
| Foundry | åœ¨å†…ç½® EVM ä¸­ç›´æ¥æ‰§è¡Œ | å¿« ğŸš€ |

**æ€§èƒ½å¯¹æ¯”ï¼š**
- Hardhatï¼š100ä¸ªæµ‹è¯•éœ€è¦ ~30ç§’
- Foundryï¼š100ä¸ªæµ‹è¯•éœ€è¦ ~2ç§’

**ä¼˜åŠ¿ 3ï¼šå¼ºå¤§çš„çŠ¶æ€æ¨¡æ‹Ÿ**

Foundry æä¾›ä¸°å¯Œçš„ **Cheatcodesï¼ˆä½œå¼Šç ï¼‰** æ¥æ¨¡æ‹ŸåŒºå—é“¾çŠ¶æ€ï¼š

```solidity
// æ¨¡æ‹Ÿè´¦æˆ·ä½™é¢
vm.deal(alice, 100 ether);

// æ¨¡æ‹Ÿä»å…¶ä»–åœ°å€è°ƒç”¨
vm.prank(alice);
pool.swap(...);

// åœ¨ä»»æ„åœ°å€éƒ¨ç½²åˆçº¦
vm.etch(address(pool), bytecode);

// æ—¶é—´æ—…è¡Œ
vm.warp(block.timestamp + 1 days);

// å¿«ç…§å’Œå›æ»š
uint256 snapshot = vm.snapshot();
// ... æ‰§è¡Œä¸€äº›æ“ä½œ
vm.revertTo(snapshot);
```

### 3.3 Foundry å·¥å…·é“¾

Foundry æ˜¯ä¸€ä¸ª**å·¥å…·é›†åˆ**ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒå·¥å…·ï¼š

**1. Forgeï¼ˆæµ‹è¯•æ¡†æ¶ï¼‰** ğŸ”¨

æ ¸å¿ƒåŠŸèƒ½ï¼š
- ç¼–è¯‘ Solidity åˆçº¦
- è¿è¡Œæµ‹è¯•ï¼ˆä½¿ç”¨ Solidityï¼‰
- ç”Ÿæˆ Gas æŠ¥å‘Š
- ä»£ç è¦†ç›–ç‡åˆ†æ
- Fuzzing æµ‹è¯•

å¸¸ç”¨å‘½ä»¤ï¼š
```bash
forge build              # ç¼–è¯‘åˆçº¦
forge test               # è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test -vvv          # è¯¦ç»†è¾“å‡º
forge test --gas-report  # Gas ä½¿ç”¨æŠ¥å‘Š
forge coverage           # ä»£ç è¦†ç›–ç‡
```

**2. Anvilï¼ˆæœ¬åœ°èŠ‚ç‚¹ï¼‰** âš“

ç‰¹ç‚¹ï¼š
- ä¸“ä¸ºå¼€å‘è®¾è®¡çš„æœ¬åœ°ä»¥å¤ªåŠèŠ‚ç‚¹
- å³æ—¶æŒ–çŸ¿ï¼ˆ0ç§’å‡ºå—ï¼‰
- é¢„ç½®æµ‹è¯•è´¦æˆ·ï¼ˆå¸¦æœ‰å¤§é‡ ETHï¼‰
- æ”¯æŒ Fork ä¸»ç½‘çŠ¶æ€

å¯åŠ¨æ–¹å¼ï¼š
```bash
anvil                    # å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹
anvil --fork-url $RPC    # Fork ä¸»ç½‘
```

**3. Castï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰** ğŸ¯

å®ç”¨åŠŸèƒ½ï¼š
- å‘é€äº¤æ˜“
- æŸ¥è¯¢é“¾ä¸Šæ•°æ®
- ç¼–ç /è§£ç  ABI
- å•ä½è½¬æ¢

å¸¸ç”¨å‘½ä»¤ï¼š
```bash
cast send <address> <sig> <args>     # å‘é€äº¤æ˜“
cast call <address> <sig> <args>     # è°ƒç”¨å‡½æ•°ï¼ˆä¸å‘äº¤æ˜“ï¼‰
cast balance <address>               # æŸ¥è¯¢ä½™é¢
cast block-number                    # å½“å‰åŒºå—å·
cast abi-encode "mint(uint256)" 100  # ABI ç¼–ç 
```

---

## å››ã€å‰ç«¯å¼€å‘å·¥å…·

### 4.1 Ethers.jsï¼šWeb3 æ ‡å‡†åº“

**Ethers.js** æ˜¯ä»¥å¤ªåŠçš„ JavaScript SDKï¼Œæä¾›äº†å®Œæ•´çš„åŒºå—é“¾äº¤äº’èƒ½åŠ›ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

```javascript
import { ethers } from 'ethers';

// 1. è¿æ¥åˆ°èŠ‚ç‚¹
const provider = new ethers.providers.JsonRpcProvider(
    'http://localhost:8545'
);

// 2. åˆ›å»ºé’±åŒ…
const wallet = new ethers.Wallet(privateKey, provider);

// 3. è¿æ¥åˆçº¦
const pool = new ethers.Contract(
    poolAddress,
    poolABI,
    wallet
);

// 4. è¯»å–æ•°æ®ï¼ˆå…è´¹ï¼‰
const balance = await pool.balanceOf(userAddress);

// 5. å‘é€äº¤æ˜“ï¼ˆéœ€ä»˜è´¹ï¼‰
const tx = await pool.mint(amount);
await tx.wait(); // ç­‰å¾…ç¡®è®¤

// 6. ç›‘å¬äº‹ä»¶
pool.on('Mint', (sender, amount) => {
    console.log(`${sender} minted ${amount}`);
});
```

**Ethers.js vs Web3.jsï¼š**

| ç‰¹æ€§ | Ethers.js | Web3.js |
|------|----------|---------|
| åŒ…å¤§å° | 88 KB | 260 KB |
| API è®¾è®¡ | ç°ä»£ã€ç®€æ´ | ä¼ ç»Ÿã€å¤æ‚ |
| æ–‡æ¡£è´¨é‡ | ä¼˜ç§€ | è¾ƒå¥½ |
| ç¤¾åŒºè¶‹åŠ¿ | å¿«é€Ÿå¢é•¿ | ç¨³å®š |
| æ¨èåº¦ | â­â­â­â­â­ | â­â­â­ |

### 4.2 MetaMaskï¼šæµè§ˆå™¨é’±åŒ…

**MetaMask** æ˜¯æœ€æµè¡Œçš„ä»¥å¤ªåŠæµè§ˆå™¨é’±åŒ…ï¼š

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

- ğŸ” åˆ›å»ºå’Œå­˜å‚¨ç§é’¥
- ğŸ’¼ ç®¡ç†å¤šä¸ªè´¦æˆ·
- ğŸŒ è¿æ¥ä¸åŒç½‘ç»œï¼ˆä¸»ç½‘ã€æµ‹è¯•ç½‘ã€æœ¬åœ°èŠ‚ç‚¹ï¼‰
- âœï¸ ç­¾ç½²äº¤æ˜“å’Œæ¶ˆæ¯
- ğŸ”Œ ä¸ DApp äº¤äº’

**åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼š**

- è¿æ¥åˆ°æœ¬åœ° Anvil èŠ‚ç‚¹
- ç­¾ç½²äº¤æ˜“å¹¶å‘é€åˆ°åˆçº¦
- æ˜¾ç¤ºäº¤æ˜“çŠ¶æ€å’Œä½™é¢

**æ·»åŠ æœ¬åœ°ç½‘ç»œåˆ° MetaMaskï¼š**

```
ç½‘ç»œåç§°: Localhost 8545
RPC URL: http://localhost:8545
é“¾ ID: 31337
è´§å¸ç¬¦å·: ETH
```

### 4.3 Reactï¼šå‰ç«¯æ¡†æ¶

**React** æ˜¯æœ€æµè¡Œçš„ JavaScript å‰ç«¯æ¡†æ¶ä¹‹ä¸€ã€‚

> ğŸ“Œ **æ— éœ€æ‹…å¿ƒ**  
> æ‚¨ä¸éœ€è¦æ·±å…¥äº†è§£ Reactï¼æˆ‘ä¼šæä¾›å®Œæ•´çš„æ¨¡æ¿åº”ç”¨ï¼Œæ‚¨åªéœ€è¦ï¼š
>
> - å®‰è£…ä¾èµ–
> - è¿è¡Œå¼€å‘æœåŠ¡å™¨
> - äº†è§£å¦‚ä½•è°ƒç”¨åˆçº¦å‡½æ•°

**é¡¹ç›®ç»“æ„é¢„è§ˆï¼š**
```
ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.js              # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Pool.js         # æ± å­äº¤äº’ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ Swap.js         # äº¤æ¢ç•Œé¢
â”‚   â”‚   â””â”€â”€ Mint.js         # æ·»åŠ æµåŠ¨æ€§ç•Œé¢
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useContract.js  # åˆçº¦äº¤äº’ Hook
â”œâ”€â”€ package.json
â””â”€â”€ public/
```

---

## äº”ã€é¡¹ç›®æ­å»ºå®æˆ˜

### 5.1 å®‰è£… Foundry

**macOS / Linuxï¼š**

```bash
# ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬
curl -L https://foundry.paradigm.xyz | bash

# å®‰è£…æœ€æ–°ç‰ˆæœ¬
foundryup
```

**Windowsï¼š**

```bash
# ä½¿ç”¨ WSL2ï¼ˆæ¨èï¼‰
# æˆ–è€…ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶
# https://github.com/foundry-rs/foundry/releases
```

**éªŒè¯å®‰è£…ï¼š**

```bash
forge --version
# forge 0.2.0 (...)

anvil --version
# anvil 0.2.0 (...)

cast --version
# cast 0.2.0 (...)
```

### 5.2 åˆ›å»º Foundry é¡¹ç›®

**æ­¥éª¤ 1ï¼šåˆå§‹åŒ–é¡¹ç›®**

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir uniswapv3_tech
cd uniswapv3_tech

# åˆå§‹åŒ– Foundry é¡¹ç›®
forge init
```

> ğŸ’¡ **VS Code ç”¨æˆ·æç¤º**  
> å¦‚æœæ‚¨ä½¿ç”¨ Visual Studio Codeï¼Œæ·»åŠ  `--vscode` å‚æ•°ï¼š
> ```bash
> forge init --vscode
> ```
> Forge ä¼šè‡ªåŠ¨ç”Ÿæˆ VS Code çš„é…ç½®æ–‡ä»¶ï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

**æ­¥éª¤ 2ï¼šé¡¹ç›®ç»“æ„**

Forge ä¼šåˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
uniswapv3_tech/
â”œâ”€â”€ foundry.toml           # Foundry é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/                   # åˆçº¦æºä»£ç 
â”‚   â””â”€â”€ Counter.sol        # ç¤ºä¾‹åˆçº¦ï¼ˆå¯åˆ é™¤ï¼‰
â”œâ”€â”€ test/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ Counter.t.sol      # ç¤ºä¾‹æµ‹è¯•ï¼ˆå¯åˆ é™¤ï¼‰
â”œâ”€â”€ script/                # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ Counter.s.sol      # ç¤ºä¾‹è„šæœ¬ï¼ˆå¯åˆ é™¤ï¼‰
â””â”€â”€ lib/                   # ä¾èµ–åº“
    â””â”€â”€ forge-std/         # Foundry æ ‡å‡†åº“
```

**æ­¥éª¤ 3ï¼šæ¸…ç†ç¤ºä¾‹æ–‡ä»¶**

```bash
# åˆ é™¤ç¤ºä¾‹æ–‡ä»¶ï¼Œä¸ºæˆ‘ä»¬çš„é¡¹ç›®è…¾å‡ºç©ºé—´
rm src/Counter.sol
rm test/Counter.t.sol
rm script/Counter.s.sol
```

### 5.3 é…ç½® foundry.toml

ç¼–è¾‘ `foundry.toml` æ–‡ä»¶ï¼Œæ·»åŠ é¡¹ç›®é…ç½®ï¼š

```toml
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
solc_version = "0.8.20"

# ä¼˜åŒ–å™¨è®¾ç½®
optimizer = true
optimizer_runs = 200

# Gas æŠ¥å‘Š
gas_reports = ["*"]

# æµ‹è¯•é…ç½®
verbosity = 3

# æ ¼å¼åŒ–
[fmt]
line_length = 100
tab_width = 4
bracket_spacing = true

# RPC ç«¯ç‚¹ï¼ˆç”¨äº Fork æµ‹è¯•ï¼‰
[rpc_endpoints]
mainnet = "${MAINNET_RPC_URL}"
```

### 5.4 åˆ›å»ºå‰ç«¯åº”ç”¨

**æ­¥éª¤ 1ï¼šä½¿ç”¨ Create React App**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
npx create-react-app ui
```

> â³ **è¯·ç¨å€™**  
> è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œä¼šä¸‹è½½å’Œå®‰è£…å¤§é‡ä¾èµ–åŒ…ã€‚

**æ­¥éª¤ 2ï¼šå®‰è£… Ethers.js**

```bash
cd ui
npm install ethers@^5.7.0
```

**æ­¥éª¤ 3ï¼šéªŒè¯å®‰è£…**

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm start

# æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ http://localhost:3000
# çœ‹åˆ° React æ¬¢è¿é¡µé¢è¡¨ç¤ºå®‰è£…æˆåŠŸ
```

**æ­¥éª¤ 4ï¼šé¡¹ç›®ç»“æ„**

```
ui/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.js            # æˆ‘ä»¬å°†ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶
â”‚   â”œâ”€â”€ App.css
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ package.json
â””â”€â”€ node_modules/
```

### 5.5 å®‰è£… MetaMask

**æ­¥éª¤ 1ï¼šå®‰è£…æµè§ˆå™¨æ‰©å±•**

è®¿é—® [MetaMask å®˜ç½‘](https://metamask.io/) å¹¶å®‰è£…å¯¹åº”æµè§ˆå™¨çš„æ‰©å±•ï¼š
- Chrome/Brave: Chrome Web Store
- Firefox: Firefox Add-ons
- Edge: Edge Add-ons

**æ­¥éª¤ 2ï¼šåˆ›å»ºé’±åŒ…**

1. ç‚¹å‡»"åˆ›å»ºé’±åŒ…"
2. è®¾ç½®å¯†ç 
3. **å¤‡ä»½åŠ©è®°è¯**ï¼ˆéå¸¸é‡è¦ï¼ï¼‰
4. ç¡®è®¤åŠ©è®°è¯

**æ­¥éª¤ 3ï¼šæ·»åŠ æœ¬åœ°ç½‘ç»œ**

1. ç‚¹å‡» MetaMask é¡¶éƒ¨çš„ç½‘ç»œä¸‹æ‹‰èœå•
2. é€‰æ‹©"æ·»åŠ ç½‘ç»œ" â†’ "æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ"
3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   ```
   ç½‘ç»œåç§°: Localhost 8545
   æ–° RPC URL: http://127.0.0.1:8545
   é“¾ ID: 31337
   è´§å¸ç¬¦å·: ETH
   ```
4. ä¿å­˜

---

## å…­ã€éªŒè¯å¼€å‘ç¯å¢ƒ

### 6.1 æµ‹è¯• Forge

**åˆ›å»ºä¸€ä¸ªç®€å•çš„åˆçº¦ï¼š**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cat > src/Hello.sol << 'EOF'
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract Hello {
    string public greeting = "Hello, Uniswap V3!";
    
    function setGreeting(string memory _greeting) public {
        greeting = _greeting;
    }
}
EOF
```

**ç¼–è¯‘åˆçº¦ï¼š**

```bash
forge build

# è¾“å‡ºï¼š
# [â Š] Compiling...
# [â ’] Compiling 1 files with 0.8.20
# [â ¢] Solc 0.8.20 finished in 1.23s
# Compiler run successful!
```

**åˆ›å»ºæµ‹è¯•ï¼š**

```bash
cat > test/Hello.t.sol << 'EOF'
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "../src/Hello.sol";

contract HelloTest is Test {
    Hello hello;
    
    function setUp() public {
        hello = new Hello();
    }
    
    function testInitialGreeting() public {
        assertEq(hello.greeting(), "Hello, Uniswap V3!");
    }
    
    function testSetGreeting() public {
        hello.setGreeting("Hello, World!");
        assertEq(hello.greeting(), "Hello, World!");
    }
}
EOF
```

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
forge test -vv

# è¾“å‡ºï¼š
# Running 2 tests for test/Hello.t.sol:HelloTest
# [PASS] testInitialGreeting() (gas: 12345)
# [PASS] testSetGreeting() (gas: 23456)
# Suite result: ok. 2 passed; 0 failed; 0 skipped; finished in 4.52ms (2.11ms CPU time)
```

### 6.2 æµ‹è¯• Anvil

**å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ï¼š**

```bash
anvil

# è¾“å‡ºï¼š
#                              _   _
#                             (_) | |
#       __ _   _ __   __   __  _  | |
#      / _` | | '_ \  \ \ / / | | | |
#     | (_| | | | | |  \ V /  | | | |
#      \__,_| |_| |_|   \_/   |_| |_|
#
# Available Accounts
# ==================
# (0) 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
# (1) 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000 ETH)
# ...
#
# Listening on 127.0.0.1:8545
```

**åœ¨æ–°ç»ˆç«¯æµ‹è¯•è¿æ¥ï¼š**

```bash
# æŸ¥è¯¢åŒºå—å·
cast block-number
# è¾“å‡ºï¼š0

# æŸ¥è¯¢è´¦æˆ·ä½™é¢
cast balance 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
# è¾“å‡ºï¼š10000000000000000000000ï¼ˆ10000 ETH in Weiï¼‰
```

### 6.3 æµ‹è¯•å®Œæ•´å·¥ä½œæµ

**éƒ¨ç½²åˆçº¦åˆ°æœ¬åœ°èŠ‚ç‚¹ï¼š**

```bash
# ç¡®ä¿ Anvil æ­£åœ¨è¿è¡Œ

# éƒ¨ç½² Hello åˆçº¦ï¼ˆæ³¨æ„ï¼šå¿…é¡»æ·»åŠ  --broadcast å‚æ•°æ‰èƒ½çœŸæ­£éƒ¨ç½²ï¼‰
forge create src/Hello.sol:Hello \
    --rpc-url http://localhost:8545 \
    --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    --broadcast
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
[â Š] Compiling...
No files changed, compilation skipped
Deployer: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
Deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3
Transaction hash: 0x...
```

> ğŸ“Œ **é‡è¦æç¤º**
>
> - **å¿…é¡»æ·»åŠ  `--broadcast` å‚æ•°**ï¼Œå¦åˆ™åªä¼šæ¨¡æ‹Ÿéƒ¨ç½²ï¼ˆDry runï¼‰è€Œä¸ä¼šçœŸæ­£å‘é€äº¤æ˜“
> - å¦‚æœå¿˜è®°æ·»åŠ  `--broadcast`ï¼Œä¼šçœ‹åˆ°è­¦å‘Šï¼š`Warning: Dry run enabled, not broadcasting transaction`
> - `--private-key` å‚æ•°ä½¿ç”¨çš„æ˜¯ Anvil æä¾›çš„ç¬¬ä¸€ä¸ªæµ‹è¯•è´¦æˆ·ç§é’¥

**ä½¿ç”¨ Cast ä¸åˆçº¦äº¤äº’ï¼š**

```bash
# è¯»å– greetingï¼ˆå…è´¹ï¼‰
cast call 0x5FbDB2315678afecb367f032d93F642f64180aa3 "greeting()" | cast --to-ascii

# è¾“å‡ºï¼šHello, Uniswap V3!

# ä¿®æ”¹ greetingï¼ˆéœ€è¦å‘äº¤æ˜“ï¼‰
cast send --rpc-url http://localhost:8545 \
    --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    0x5FbDB2315678afecb367f032d93F642f64180aa3 \
    'setGreeting(string)' \
    'Hello from Cast!'

# è¾“å‡ºï¼š
# blockHash            0x...
# blockNumber          2
# status               1 (success)
# transactionHash      0x...

# å†æ¬¡è¯»å–éªŒè¯
cast call 0x5FbDB2315678afecb367f032d93F642f64180aa3 "greeting()" | cast --to-ascii

# è¾“å‡ºï¼šHello from Cast!
```

> âš ï¸ **å¼•å·ä½¿ç”¨æ³¨æ„äº‹é¡¹**
>
> - åœ¨ `cast send` å‘½ä»¤ä¸­ï¼Œ**å»ºè®®ä½¿ç”¨å•å¼•å·** `'...'` è€Œä¸æ˜¯åŒå¼•å· `"..."`
> - æŸäº› shellï¼ˆç‰¹åˆ«æ˜¯ zshï¼‰ä¸­ï¼ŒåŒå¼•å·å¯èƒ½å¯¼è‡´å‘½ä»¤è¡Œè§£æé—®é¢˜
> - å¦‚æœå‘½ä»¤åå‡ºç° `\` å¹¶å¡ä½ï¼Œè¯´æ˜ shell åœ¨ç­‰å¾…å¤šè¡Œè¾“å…¥ï¼Œè¿™æ—¶è¯·æŒ‰ `Ctrl+C` å–æ¶ˆå¹¶ä½¿ç”¨å•å¼•å·é‡è¯•
> - å‡½æ•°ç­¾åï¼ˆå¦‚ `'setGreeting(string)'`ï¼‰å’Œå­—ç¬¦ä¸²å‚æ•°éƒ½åº”ä½¿ç”¨å•å¼•å·

---

## ä¸ƒã€å¼€å‘å·¥ä½œæµæœ€ä½³å®è·µ

### 7.1 æ¨èçš„å¼€å‘æµç¨‹

```
1. ç¼–å†™åˆçº¦
   â””â”€> src/*.sol

2. ç¼–å†™æµ‹è¯•
   â””â”€> test/*.t.sol

3. è¿è¡Œæµ‹è¯•
   â””â”€> forge test

4. ä¿®å¤é—®é¢˜
   â””â”€> å›åˆ°æ­¥éª¤ 1

5. éƒ¨ç½²åˆ°æœ¬åœ°èŠ‚ç‚¹
   â””â”€> anvil + forge create

6. å‰ç«¯é›†æˆæµ‹è¯•
   â””â”€> npm startï¼ˆåœ¨ ui/ ç›®å½•ï¼‰

7. éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
   â””â”€> forge script

8. éƒ¨ç½²åˆ°ä¸»ç½‘
   â””â”€> forge script --broadcast
```

### 7.2 å¸¸ç”¨ Forge å‘½ä»¤é€ŸæŸ¥

```bash
# ç¼–è¯‘
forge build                        # ç¼–è¯‘æ‰€æœ‰åˆçº¦
forge build --force                # å¼ºåˆ¶é‡æ–°ç¼–è¯‘

# æµ‹è¯•
forge test                         # è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test -vv                     # è¯¦ç»†è¾“å‡º
forge test -vvvv                   # è¶…è¯¦ç»†è¾“å‡ºï¼ˆåŒ…å«traceï¼‰
forge test --match-test testMint   # è¿è¡Œç‰¹å®šæµ‹è¯•
forge test --match-contract Pool   # è¿è¡Œç‰¹å®šåˆçº¦çš„æµ‹è¯•
forge test --gas-report            # æ˜¾ç¤º Gas æŠ¥å‘Š

# ä»£ç æ ¼å¼åŒ–
forge fmt                          # æ ¼å¼åŒ–æ‰€æœ‰æ–‡ä»¶
forge fmt src/Pool.sol             # æ ¼å¼åŒ–æŒ‡å®šæ–‡ä»¶

# ä»£ç è¦†ç›–ç‡
forge coverage                     # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
forge coverage --report lcov       # ç”Ÿæˆ LCOV æ ¼å¼æŠ¥å‘Š

# Gas å¿«ç…§
forge snapshot                     # åˆ›å»º Gas å¿«ç…§
forge snapshot --diff              # å¯¹æ¯”å¿«ç…§å·®å¼‚

# ä¾èµ–ç®¡ç†
forge install <org>/<repo>         # å®‰è£…ä¾èµ–
forge update                       # æ›´æ–°æ‰€æœ‰ä¾èµ–
forge remove <dep>                 # åˆ é™¤ä¾èµ–
```

### 7.3 VS Code æ¨èæ’ä»¶

å®‰è£…ä»¥ä¸‹æ’ä»¶æå‡å¼€å‘ä½“éªŒï¼š

**1. Solidityï¼ˆä½œè€…ï¼šJuan Blancoï¼‰** â­ å¿…è£…
- ğŸ” æœç´¢å…³é”®è¯ï¼š`Solidity` æˆ– `JuanBlanco.solidity`
- åŠŸèƒ½ï¼šè¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨ã€é”™è¯¯æ£€æŸ¥ã€Linting
- è¿™æ˜¯æœ€æµè¡Œçš„ Solidity æ’ä»¶ï¼Œä¸‹è½½é‡è¶…è¿‡ 100 ä¸‡

**2. Prettier - Code formatterï¼ˆä½œè€…ï¼šPrettierï¼‰**

- ğŸ” æœç´¢å…³é”®è¯ï¼š`Prettier` æˆ– `esbenp.prettier-vscode`
- åŠŸèƒ½ï¼šä»£ç è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œæ”¯æŒå¤šç§è¯­è¨€
- éœ€è¦é…åˆ `prettier-plugin-solidity` ä½¿ç”¨

**3. GitLensï¼ˆä½œè€…ï¼šGitKrakenï¼‰**

- ğŸ” æœç´¢å…³é”®è¯ï¼š`GitLens` æˆ– `eamodio.gitlens`
- åŠŸèƒ½ï¼šGit å†å²æŸ¥çœ‹ã€ä»£ç ä½œè€…è¿½è¸ªã€è¡Œå†… blame ä¿¡æ¯
- Git å¢å¼ºå·¥å…·ï¼Œé Solidity ä¸“ç”¨ä½†æå…¶æœ‰ç”¨

**4. Error Lensï¼ˆä½œè€…ï¼šAlexanderï¼‰** æ¨è

- ğŸ” æœç´¢å…³é”®è¯ï¼š`Error Lens` æˆ– `usernamehw.errorlens`
- åŠŸèƒ½ï¼šåœ¨ä»£ç è¡Œå†…ç›´æ¥æ˜¾ç¤ºé”™è¯¯å’Œè­¦å‘Š
- æå¤§æå‡è°ƒè¯•æ•ˆç‡

### 7.4 è°ƒè¯•æŠ€å·§

**ä½¿ç”¨ `console.log` è°ƒè¯•ï¼š**

```solidity
// åœ¨åˆçº¦ä¸­å¯¼å…¥
import "forge-std/console.sol";

contract Pool {
    function swap(uint256 amount) public {
        // è¾“å‡ºè°ƒè¯•ä¿¡æ¯
        console.log("Swapping amount:", amount);
        console.log("Current price:", price);
        
        // ... åˆçº¦é€»è¾‘
    }
}
```

**è¿è¡Œæµ‹è¯•æ—¶æŸ¥çœ‹è¾“å‡ºï¼š**

```bash
forge test -vv  # ä¼šæ˜¾ç¤º console.log çš„è¾“å‡º
```

**ä½¿ç”¨ Gas æŠ¥å‘Šå‘ç°é—®é¢˜ï¼š**

```bash
forge test --gas-report

# è¾“å‡ºï¼š
# | Function | Min | Avg | Max |
# |----------|-----|-----|-----|
# | mint     | 100 | 150 | 200 |
# | swap     | 200 | 300 | 400 |
```

---

## å…«ã€å¸¸è§é—®é¢˜è§£å†³

### 8.1 Foundry ç›¸å…³é—®é¢˜

**é—®é¢˜ 1ï¼š`forge` å‘½ä»¤æœªæ‰¾åˆ°**

```bash
# è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ·»åŠ åˆ° PATH
export PATH="$HOME/.foundry/bin:$PATH"

# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc æ°¸ä¹…ç”Ÿæ•ˆ
echo 'export PATH="$HOME/.foundry/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

**é—®é¢˜ 2ï¼šç¼–è¯‘å¤±è´¥**

```bash
# æ£€æŸ¥ Solidity ç‰ˆæœ¬
forge --version

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
foundryup

# æ¸…ç†ç¼“å­˜é‡æ–°ç¼–è¯‘
forge clean
forge build
```

**é—®é¢˜ 3ï¼šæµ‹è¯•å¤±è´¥ä½†æ²¡æœ‰è¯¦ç»†ä¿¡æ¯**

```bash
# ä½¿ç”¨æ›´é«˜çš„è¯¦ç»†åº¦çº§åˆ«
forge test -vvvv
```

### 8.2 MetaMask ç›¸å…³é—®é¢˜

**é—®é¢˜ 1ï¼šæ— æ³•è¿æ¥åˆ°æœ¬åœ°ç½‘ç»œ**

- ç¡®ä¿ Anvil æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ç½‘ç»œé…ç½®ä¸­çš„ RPC URL
- å°è¯•é‡å¯ MetaMask

**é—®é¢˜ 2ï¼šäº¤æ˜“å¤±è´¥ "insufficient funds"**

- ä½¿ç”¨ Anvil æä¾›çš„æµ‹è¯•è´¦æˆ·
- å¯¼å…¥ Anvil è¾“å‡ºçš„ç§é’¥åˆ° MetaMask

**é—®é¢˜ 3ï¼šNonce too high é”™è¯¯**

- åœ¨ MetaMask ä¸­é‡ç½®è´¦æˆ·ï¼š
  è®¾ç½® â†’ é«˜çº§ â†’ é‡ç½®è´¦æˆ·

### 8.3 å‰ç«¯ç›¸å…³é—®é¢˜

**é—®é¢˜ 1ï¼š`npm start` ç«¯å£è¢«å ç”¨**

```bash
# æŒ‡å®šå…¶ä»–ç«¯å£
PORT=3001 npm start
```

**é—®é¢˜ 2ï¼šæ— æ³•è¿æ¥åˆ°åˆçº¦**

- æ£€æŸ¥åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ ABI æ–‡ä»¶æ˜¯å¦æœ€æ–°
- éªŒè¯ç½‘ç»œæ˜¯å¦æ­£ç¡®

---

## ç›¸å…³èµ„æº

### å¼€å‘å·¥å…·æ–‡æ¡£
- [Foundry Book](https://book.getfoundry.sh/) - **Foundry å®Œæ•´æ–‡æ¡£**
- [Ethers.js æ–‡æ¡£](https://docs.ethers.org/v5/) - Web3 åº“æ–‡æ¡£
- [MetaMask æ–‡æ¡£](https://docs.metamask.io/) - é’±åŒ…å¼€å‘æŒ‡å—
- [Solidity æ–‡æ¡£](https://docs.soliditylang.org/) - Solidity è¯­è¨€å‚è€ƒ

### å­¦ä¹ æ•™ç¨‹
- [Uniswap V3 Development Book](https://uniswapv3book.com/) - **æœ¬ç³»åˆ—ä¸»è¦å‚è€ƒæ•™ç¨‹**
- [Foundry æ•™ç¨‹](https://github.com/foundry-rs/foundry-book) - å®˜æ–¹æ•™ç¨‹
- [Solidity by Example](https://solidity-by-example.org/) - Solidity ç¤ºä¾‹ä»£ç 

### ç³»åˆ—é¡¹ç›®å¯¹æ¯”å­¦ä¹ 
- [UniswapV1 æŠ€æœ¯å­¦ä¹ ](https://github.com/RyanWeb31110/uniswapv1_tech) - ç†è§£åŸºç¡€ AMM
- [UniswapV2 æŠ€æœ¯å­¦ä¹ ](https://github.com/RyanWeb31110/uniswapv2_tech) - å­¦ä¹ æ’å®šä¹˜ç§¯å…¬å¼
- [UniswapV3 æŠ€æœ¯å­¦ä¹ ](https://github.com/RyanWeb31110/uniswapv3_tech) - **æŒæ¡é›†ä¸­æµåŠ¨æ€§**

### å¼€å‘å·¥å…·
- [Foundry GitHub](https://github.com/foundry-rs/foundry) - Foundry æºç å’Œé—®é¢˜è¿½è¸ª
- [Anvil ä½¿ç”¨æŒ‡å—](https://book.getfoundry.sh/anvil/) - æœ¬åœ°èŠ‚ç‚¹è¯¦ç»†è¯´æ˜
- [Cast å‘½ä»¤å‚è€ƒ](https://book.getfoundry.sh/cast/) - CLI å·¥å…·å®Œæ•´å‘½ä»¤

### ç¤¾åŒºèµ„æº
- [Foundry Discord](https://discord.gg/foundry) - å®˜æ–¹ç¤¾åŒº
- [Ethereum Stack Exchange](https://ethereum.stackexchange.com/) - æŠ€æœ¯é—®ç­”
- [r/ethdev](https://www.reddit.com/r/ethdev/) - Reddit å¼€å‘è€…ç¤¾åŒº

---

## é¡¹ç›®ä»“åº“

https://github.com/RyanWeb31110/uniswapv3_tech

