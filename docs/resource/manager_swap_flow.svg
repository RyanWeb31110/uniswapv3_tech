<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <defs>
    <style>
      .actor-box { fill: #F3E5F5; stroke: #7B1FA2; stroke-width: 2; }
      .actor-text { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #6A1B9A; text-anchor: middle; }
      .step-text { font-family: Arial, sans-serif; font-size: 14px; fill: #424242; }
      .arrow { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #FF6F00; stroke-width: 2; fill: none; marker-end: url(#arrowhead-orange); stroke-dasharray: 5,5; }
      .step-number { font-family: Arial, sans-serif; font-size: 12px; fill: #D84315; font-weight: bold; }
      .lifecycle { stroke: #BDBDBD; stroke-width: 1; stroke-dasharray: 5,5; fill: none; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#424242" />
    </marker>
    
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF6F00" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="400" y="30" style="font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #7B1FA2; text-anchor: middle;">代币交换的完整流程</text>
  
  <!-- 参与者 -->
  <rect x="50" y="60" width="120" height="50" rx="5" class="actor-box"/>
  <text x="110" y="90" class="actor-text">用户</text>
  
  <rect x="340" y="60" width="120" height="50" rx="5" class="actor-box"/>
  <text x="400" y="90" class="actor-text">Manager 合约</text>
  
  <rect x="630" y="60" width="120" height="50" rx="5" class="actor-box"/>
  <text x="690" y="90" class="actor-text">Pool 合约</text>
  
  <!-- 生命线 -->
  <line x1="110" y1="110" x2="110" y2="560" class="lifecycle"/>
  <line x1="400" y1="110" x2="400" y2="560" class="lifecycle"/>
  <line x1="690" y1="110" x2="690" y2="560" class="lifecycle"/>
  
  <!-- 步骤 1: approve -->
  <text x="20" y="155" class="step-number">1</text>
  <line x1="110" y1="150" x2="390" y2="150" class="arrow"/>
  <text x="220" y="145" class="step-text">approve(Manager)</text>
  
  <!-- 步骤 2: swap -->
  <text x="20" y="205" class="step-number">2</text>
  <line x1="110" y1="200" x2="390" y2="200" class="arrow"/>
  <text x="220" y="195" class="step-text">swap(...)</text>
  
  <!-- 步骤 3: Manager调用Pool.swap -->
  <text x="20" y="255" class="step-number">3</text>
  <line x1="400" y1="250" x2="680" y2="250" class="arrow"/>
  <text x="510" y="245" class="step-text">swap(...)</text>
  
  <!-- 步骤 4: Pool回调Manager -->
  <text x="20" y="305" class="step-number">4</text>
  <line x1="680" y1="300" x2="410" y2="300" class="arrow-back"/>
  <text x="480" y="295" class="step-text">uniswapV3SwapCallback</text>
  
  <!-- 步骤 5: Manager从用户transferFrom -->
  <text x="20" y="355" class="step-number">5</text>
  <line x1="400" y1="350" x2="120" y2="350" class="arrow-back"/>
  <text x="230" y="345" class="step-text">transferFrom(user)</text>
  
  <!-- 步骤 6: Manager transfer给Pool -->
  <text x="20" y="405" class="step-number">6</text>
  <line x1="400" y1="400" x2="680" y2="400" class="arrow"/>
  <text x="510" y="395" class="step-text">transfer(pool)</text>
  
  <!-- 步骤 7: Pool直接发送输出代币给用户 -->
  <text x="20" y="455" class="step-number">7</text>
  <line x1="690" y1="450" x2="120" y2="450" class="arrow-back"/>
  <text x="380" y="445" class="step-text">transfer(user) - 输出代币</text>
  
  <!-- 说明文本 -->
  <text x="50" y="520" style="font-family: Arial, sans-serif; font-size: 12px; fill: #666;">
    <tspan x="50" dy="0">关键差异：</tspan>
    <tspan x="50" dy="18">• 与 Mint 流程类似，但输出代币直接从 Pool 发送给用户</tspan>
    <tspan x="50" dy="18">• Manager 只负责接收输入代币并转给 Pool</tspan>
    <tspan x="50" dy="18">• Pool 会将输出代币直接转给 recipient（用户地址）</tspan>
  </text>
</svg>

